# Test: Union types (tagged unions / sum types)
# Unions are flattened to structs with __tag (int) + all variant fields.
# Variant 0 = first variant, 1 = second, etc.

union Shape:
    Circle(radius: float)
    Rect(width: float, height: float)

def test_union_create_circle() -> int:
    # Create a Circle variant (tag 0)
    let s: Shape = Shape{__tag: 0, radius: 3.14, width: 0.0, height: 0.0}
    let t: int = s.__tag
    if t == 0:
        print("PASS union create circle")
    else:
        print("FAIL union create circle")
        return 1
    return 0

def test_union_create_rect() -> int:
    # Create a Rect variant (tag 1)
    let s: Shape = Shape{__tag: 1, radius: 0.0, width: 10.0, height: 5.0}
    let t: int = s.__tag
    if t == 1:
        print("PASS union create rect")
    else:
        print("FAIL union create rect")
        return 1
    return 0

def test_union_field_access() -> int:
    # Access variant fields
    let c: Shape = Shape{__tag: 0, radius: 2.5, width: 0.0, height: 0.0}
    let r: float = c.radius
    if r == 2.5:
        print("PASS union field access")
    else:
        print("FAIL union field access")
        return 1
    return 0

def test_union_tag_fn() -> int:
    # tag() returns the tag as a string
    let s: Shape = Shape{__tag: 0, radius: 1.0, width: 0.0, height: 0.0}
    let t: str = tag(s)
    if t == "0":
        print("PASS union tag fn")
    else:
        print("FAIL union tag fn got " + t)
        return 1
    return 0

def test_union_match_tag() -> int:
    # Use match on the tag field to dispatch
    let s: Shape = Shape{__tag: 1, radius: 0.0, width: 4.0, height: 3.0}
    match s.__tag:
        case 0:
            print("FAIL union match - got circle")
            return 1
        case 1:
            let area: float = s.width * s.height
            if area == 12.0:
                print("PASS union match tag")
            else:
                print("FAIL union match area")
                return 1
        default:
            print("FAIL union match - unknown tag")
            return 1
    return 0

def main() -> int:
    test_union_create_circle()
    test_union_create_rect()
    test_union_field_access()
    test_union_tag_fn()
    test_union_match_tag()
    print("PASS")
    return 0
